{% extends "base.html" %}
{% block content %}
    <div class="divider">
        <div class="input_section">
            Welcome {{username}}

            <form class="logout_section" action="/api/logout" method="POST">
                <input type="submit" value="Logout" onclick="return confirm('{{username}}, Do you really want to log out?')">
            </form>

            Upload your favorate photo here

            <form class="upload_section" action="/api/upload" method="POST" enctype="multipart/form-data">
                <dl>
                    <p>
                        <!-- Should filter for only image files -->
                        <input type="file" name="file" autocomplete="off" required>
                    </p>
                </dl>
                <p>
                    <input type="submit" value="Submit">
                </p>
            </form>
            <p style="color:red">{{error_message if error_message}}</p>
        </div>

    <div class="gallery_section">

        <button id= "update_button" class="gallery_refresh_button" onclick="location.reload()">Refresh</button>

        <div class = "gallery_display">
            <div class="background">
                <font size="11" color>
                    Browse your uploaded images
                </font>
            </div>
            <div id = "gallery_updaing_display">
            {% for thumbnail_row in thumbnails | batch(3, '') %}
            <div class="row">
                {% for thumbnail in thumbnail_row %}
                {% if (thumbnail != '') %}
                {% set photo_id_str, file_extension, photo_name = thumbnail %}
                <div class="image_container">
                    <div class="title">{{photo_name}}</div>
                    <div class="image">
                        <form action='/api/photo_display' method="POST" width="200">
                            <input type="image" src="{{ url_for('static', filename = thumbnail_dir_path + '/' + photo_id_str + file_extension) }}" value={{photo_name}} width=200>
                            <!--No need to encode space as %20, photo_id_str = str(int)-->
                            <input type="hidden" name="photo_id" value={{photo_id_str}} />
                        </form> 
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endfor %} 
        </div>
    </div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
        $(document).on('click','#update_button',function(){
            $.ajax({
                url: "{{ url_for('render_thumbnail_gallery') }}",
                type: "POST",
                dataType: "json",
                success: function(html_data){
                    console.log(html_data)
                    $('#gallery_updaing_display').append(html_data)
                    }
                });
        });
</script>

<style>
    .divider {
        position: absolute;
        height: 100%;
        width: 100%;
    }

    .input_section {
        float: left;
        width: 40%;
        height: 100%;
    }

    .logout_section {
        position: relative;
        height: 50%;
    }

    .upload_section {
        position: relative;
        height: 50%;
    }

    .gallery_section {
        float: left;
        height: 100%;
        width: 60%;
    }

    .image_container {
        float: left;
        width: 33%;
        height: 100%;
        overflow: scroll;
    }

    .title {
        float: top;
        height: 10%;
    }

    .image {
        float: top;
        height: 90%;
        width: 100%;
    }

    .row {
        position: relative;
    }

    .background {
   position: absolute;
   top: 50%;
   left: 42%;
   bottom: 0;
   right: 0;
   z-index: -1;
   overflow: hidden;
   color:grey;
    }

   .gallery_refresh_button{
       position: relative;
       height: 7%;
       width : 100%;
       border: 1px solid;
       background: #07da63;
       border-radius: 10px 10px 10px 10px;
       box-shadow: 0 0 15px rgba(50, 50, 50, 0.7) inset;
   }

   .gallery_display{
        border: 1px solid;
        border-radius: 10px 10px 10px 10px;
        box-shadow: 0 0 15px rgba(50, 50, 50, 0.7) inset;
        height: 90%;
        margin-top: 10px;
        padding: 15px;
        overflow: scroll;
   }

</style>


{% endblock %}